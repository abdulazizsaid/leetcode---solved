<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <canvas id="canvas" width="800" height="600" style="border:1px solid #ccc;"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script>
        var canvas = new fabric.Canvas('canvas');
        var line, text, isDrawing = false;
        var scaleCm = 38; // 1 cm = 38 pixel (o'lchamingizga qarab o'zgartiring)

        canvas.on('mouse:down', function (o) {
            isDrawing = true;
            var pointer = canvas.getPointer(o.e);
            line = new fabric.Line([pointer.x, pointer.y, pointer.x, pointer.y], {
                stroke: 'red',
                strokeWidth: 2,
                selectable: false
            });
            text = new fabric.Text('', { left: pointer.x, top: pointer.y - 20, fontSize: 14 });
            canvas.add(line, text);
        });

        canvas.on('mouse:move', function (o) {
            if (!isDrawing) return;
            var pointer = canvas.getPointer(o.e);
            line.set({ x2: pointer.x, y2: pointer.y });

            // Masofa hisoblash (cm da)
            var dx = pointer.x - line.x1;
            var dy = pointer.y - line.y1;
            var distPx = Math.sqrt(dx * dx + dy * dy);
            var distCm = (distPx / scaleCm).toFixed(1);

            text.set({ text: distCm + ' sm', left: (line.x1 + pointer.x) / 2, top: (line.y1 + pointer.y) / 2 - 20 });
            canvas.renderAll();
        });

        canvas.on('mouse:up', function () {
            isDrawing = false;
            // Chiziq va textni editable qilish uchun selectable: true qilish mumkin
        });
    </script>
</body>

</html>